# Трекеры и привязка к транспортным средствам

Этот раздел описывает только те методы работы с трекерами, которые используются во внешней интеграции:

- привязка трекера к машине или прицепу;
- получение списка трекеров;
- отвязка трекера от машины или прицепа.

Общие принципы работы API описаны в:

- [Обзор API](./api/_overview.md)
- [Auth API](./api/auth.md)

---

## 1. Привязка трекера к машине или прицепу

```http
POST /api/trackers/attach
```

### Назначение

Привязать трекер к конкретному транспортному средству:

- грузовому автомобилю;
- прицепу.

### Тело запроса

```json
{
  "id": 0,
  "entityId": 0,
  "type": "Car"
}
```

Поля:

- `id` — идентификатор трекера в CARGO.RUN;
- `entityId` — идентификатор объекта (машина или прицеп);
- `type` — тип объекта:
  - `Car` — грузовой автомобиль;
  - `Trailer` — прицеп.

### Комментарии

- Для привязки необходимо знать **id трекера** и **id машины/прицепа**.
- Идентификатор трекера можно получить через метод `GET /api/trackers/get`, отфильтровав по номеру устройства (`deviceNumber`).

Пример (поиск трекера по номеру устройства в OData):

```text
GET /api/trackers/get?$filter=deviceNumber eq '1234567890'
```

Из полученного списка выбирается нужный трекер, и его `id` используется в теле запроса `POST /api/trackers/attach`.

---

## 2. Получение списка трекеров

```http
GET /api/trackers/get
```

### Назначение

Получение списка трекеров, доступных организации.  
Метод поддерживает OData-фильтрацию.

### Параметры OData

Метод поддерживает стандартные параметры:

```text
?$filter=<string>
 &$orderBy=<string>
 &$top=<int>
 &$skip=<int>
 &$count=<bool>
 &$select=<string>
 &$expand=<string>
```

Примеры использования:

1. Поиск трекера по номеру устройства:

```text
GET /api/trackers/get?$filter=deviceNumber eq '1234567890'
```

2. Получение первых 50 трекеров:

```text
GET /api/trackers/get?$top=50
```

Фактический набор полей и их типы определяются моделью `TrackerViewModel` в swagger.

---

## 3. Отвязка трекера от машины или прицепа

```http
POST /api/trackers/attach
```

### Назначение

Отвязать трекер от машины или прицепа.

### Тело запроса

```json
{
  "id": 0,
  "entityId": null,
  "type": "Car"
}
```

Поля:

- `id` — идентификатор трекера;
- `entityId` — `null` (означает, что объект отвязывается);
- `type` — тип объекта:
  - `Car` — если трекер был привязан к машине;
  - `Trailer` — если трекер был привязан к прицепу.

### Комментарии

Для отвязки трекера необходимо:

- указать корректный `id` трекера;
- указать `entityId = null`;
- задать `type` в соответствии с тем, к какому типу объекта трекер был привязан (`Car` или `Trailer`).

---

## 4. Сводка используемых методов

| Метод | Описание |
|-------|----------|
| `POST /api/trackers/attach` | Привязка трекера к машине или прицепу |
| `GET /api/trackers/get` | Получение списка трекеров (с поддержкой OData) |
| `POST /api/trackers/attach` + `entityId = null` | Отвязка трекера от машины или прицепа |

